package generate_obj_and_mock_file

import (
	"fmt"
	"io"
	"os"
	"sync"
	"time"
)

type consoleColor = int

const (
	colorBlack consoleColor = iota + 30
	colorRed
	colorGreen
	colorYellow
	colorBlue
	colorMagenta
	colorCyan
	colorWhite

	colorBold     = 1
	colorDarkGray = 90
)

// colorize returns the string s wrapped in ANSI code c
func colorize(s interface{}, c consoleColor) string {
	return fmt.Sprintf("\x1b[%dm%v\x1b[0m", c, s)
}

// CharSets contains the default character sets from
// https://github.com/briandowns/spinner.
var CharSets = map[int][]string{
	0:  {"â†", "â†–", "â†‘", "â†—", "â†’", "â†˜", "â†“", "â†™"},
	1:  {"â–", "â–ƒ", "â–„", "â–…", "â–†", "â–‡", "â–ˆ", "â–‡", "â–†", "â–…", "â–„", "â–ƒ", "â–"},
	2:  {"â––", "â–˜", "â–", "â–—"},
	3:  {"â”¤", "â”˜", "â”´", "â””", "â”œ", "â”Œ", "â”¬", "â”"},
	4:  {"â—¢", "â—£", "â—¤", "â—¥"},
	5:  {"â—°", "â—³", "â—²", "â—±"},
	6:  {"â—´", "â—·", "â—¶", "â—µ"},
	7:  {"â—", "â—“", "â—‘", "â—’"},
	8:  {".", "o", "O", "@", "*"},
	9:  {"|", "/", "-", "\\"},
	10: {"â—¡â—¡", "âŠ™âŠ™", "â— â— "},
	11: {"â£¾", "â£½", "â£»", "â¢¿", "â¡¿", "â£Ÿ", "â£¯", "â£·"},
	12: {">))'>", " >))'>", "  >))'>", "   >))'>", "    >))'>", "   <'((<", "  <'((<", " <'((<"},
	13: {"â ", "â ‚", "â „", "â¡€", "â¢€", "â  ", "â ", "â ˆ"},
	14: {"â ‹", "â ™", "â ¹", "â ¸", "â ¼", "â ´", "â ¦", "â §", "â ‡", "â "},
	15: {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"},
	16: {"â–‰", "â–Š", "â–‹", "â–Œ", "â–", "â–Ž", "â–", "â–Ž", "â–", "â–Œ", "â–‹", "â–Š", "â–‰"},
	17: {"â– ", "â–¡", "â–ª", "â–«"},
	18: {"â†", "â†‘", "â†’", "â†“"},
	19: {"â•«", "â•ª"},
	20: {"â‡", "â‡–", "â‡‘", "â‡—", "â‡’", "â‡˜", "â‡“", "â‡™"},
	21: {"â ", "â ", "â ‰", "â ™", "â š", "â ’", "â ‚", "â ‚", "â ’", "â ²", "â ´", "â ¤", "â „", "â „", "â ¤", "â  ", "â  ", "â ¤", "â ¦", "â –", "â ’", "â ", "â ", "â ’", "â “", "â ‹", "â ‰", "â ˆ", "â ˆ"},
	22: {"â ˆ", "â ‰", "â ‹", "â “", "â ’", "â ", "â ", "â ’", "â –", "â ¦", "â ¤", "â  ", "â  ", "â ¤", "â ¦", "â –", "â ’", "â ", "â ", "â ’", "â “", "â ‹", "â ‰", "â ˆ"},
	23: {"â ", "â ‰", "â ™", "â š", "â ’", "â ‚", "â ‚", "â ’", "â ²", "â ´", "â ¤", "â „", "â „", "â ¤", "â ´", "â ²", "â ’", "â ‚", "â ‚", "â ’", "â š", "â ™", "â ‰", "â "},
	24: {"â ‹", "â ™", "â š", "â ’", "â ‚", "â ‚", "â ’", "â ²", "â ´", "â ¦", "â –", "â ’", "â ", "â ", "â ’", "â “", "â ‹"},
	25: {"ï½¦", "ï½§", "ï½¨", "ï½©", "ï½ª", "ï½«", "ï½¬", "ï½­", "ï½®", "ï½¯", "ï½±", "ï½²", "ï½³", "ï½´", "ï½µ", "ï½¶", "ï½·", "ï½¸", "ï½¹", "ï½º", "ï½»", "ï½¼", "ï½½", "ï½¾", "ï½¿", "ï¾€", "ï¾", "ï¾‚", "ï¾ƒ", "ï¾„", "ï¾…", "ï¾†", "ï¾‡", "ï¾ˆ", "ï¾‰", "ï¾Š", "ï¾‹", "ï¾Œ", "ï¾", "ï¾Ž", "ï¾", "ï¾", "ï¾‘", "ï¾’", "ï¾“", "ï¾”", "ï¾•", "ï¾–", "ï¾—", "ï¾˜", "ï¾™", "ï¾š", "ï¾›", "ï¾œ", "ï¾"},
	26: {".", "..", "..."},
	27: {"â–", "â–‚", "â–ƒ", "â–„", "â–…", "â–†", "â–‡", "â–ˆ", "â–‰", "â–Š", "â–‹", "â–Œ", "â–", "â–Ž", "â–", "â–", "â–Ž", "â–", "â–Œ", "â–‹", "â–Š", "â–‰", "â–ˆ", "â–‡", "â–†", "â–…", "â–„", "â–ƒ", "â–‚", "â–"},
	28: {".", "o", "O", "Â°", "O", "o", "."},
	29: {"+", "x"},
	30: {"v", "<", "^", ">"},
	31: {">>--->", " >>--->", "  >>--->", "   >>--->", "    >>--->", "    <---<<", "   <---<<", "  <---<<", " <---<<", "<---<<"},
	32: {"|", "||", "|||", "||||", "|||||", "||||||", "|||||||", "||||||||", "|||||||", "||||||", "|||||", "||||", "|||", "||", "|"},
	33: {"[          ]", "[=         ]", "[==        ]", "[===       ]", "[====      ]", "[=====     ]", "[======    ]", "[=======   ]", "[========  ]", "[========= ]", "[==========]"},
	34: {"(*---------)", "(-*--------)", "(--*-------)", "(---*------)", "(----*-----)", "(-----*----)", "(------*---)", "(-------*--)", "(--------*-)", "(---------*)"},
	35: {"â–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’", "â–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’", "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’", "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’", "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"},
	36: {"[                    ]", "[=>                  ]", "[===>                ]", "[=====>              ]", "[======>             ]", "[========>           ]", "[==========>         ]", "[============>       ]", "[==============>     ]", "[================>   ]", "[==================> ]", "[===================>]"},
	37: {"ðŸ•", "ðŸ•‘", "ðŸ•’", "ðŸ•“", "ðŸ•”", "ðŸ••", "ðŸ•–", "ðŸ•—", "ðŸ•˜", "ðŸ•™", "ðŸ•š", "ðŸ•›"},                                                             // clock emoji: one per hour for hours 1~12
	38: {"ðŸ•", "ðŸ•œ", "ðŸ•‘", "ðŸ•", "ðŸ•’", "ðŸ•ž", "ðŸ•“", "ðŸ•Ÿ", "ðŸ•”", "ðŸ• ", "ðŸ••", "ðŸ•¡", "ðŸ•–", "ðŸ•¢", "ðŸ•—", "ðŸ•£", "ðŸ•˜", "ðŸ•¤", "ðŸ•™", "ðŸ•¥", "ðŸ•š", "ðŸ•¦", "ðŸ•›", "ðŸ•§"}, // clock emoji: one per half hour for hours 1~12
	39: {"ðŸŒ", "ðŸŒŽ", "ðŸŒ"},
	40: {"â—œ", "â—", "â—ž", "â—Ÿ"},
	41: {"â¬’", "â¬”", "â¬“", "â¬•"},
	42: {"â¬–", "â¬˜", "â¬—", "â¬™"},
	43: {"[>>>          >]", "[]>>>>        []", "[]  >>>>      []", "[]    >>>>    []", "[]      >>>>  []", "[]        >>>>[]", "[>>          >>]"},
	44: {"â™ ", "â™£", "â™¥", "â™¦"},
	45: {"âžž", "âžŸ", "âž ", "âž¡", "âž ", "âžŸ"},
	46: {"  |  ", ` \   `, "_    ", ` \   `, "  |  ", "   / ", "    _", "   / "},
	47: {"  . . . .", ".   . . .", ". .   . .", ". . .   .", ". . . .  ", ". . . . ."},
	48: {" |     ", "  /    ", "   _   ", `    \  `, "     | ", `    \  `, "   _   ", "  /    "},
	49: {"âŽº", "âŽ»", "âŽ¼", "âŽ½", "âŽ¼", "âŽ»"},
	50: {"â–¹â–¹â–¹â–¹â–¹", "â–¸â–¹â–¹â–¹â–¹", "â–¹â–¸â–¹â–¹â–¹", "â–¹â–¹â–¸â–¹â–¹", "â–¹â–¹â–¹â–¸â–¹", "â–¹â–¹â–¹â–¹â–¸"},
	51: {"[    ]", "[   =]", "[  ==]", "[ ===]", "[====]", "[=== ]", "[==  ]", "[=   ]"},
	52: {"( â—    )", "(  â—   )", "(   â—  )", "(    â— )", "(     â—)", "(    â— )", "(   â—  )", "(  â—   )", "( â—    )"},
	53: {"âœ¶", "âœ¸", "âœ¹", "âœº", "âœ¹", "âœ·"},
	54: {"â–|\\____________â–Œ", "â–_|\\___________â–Œ", "â–__|\\__________â–Œ", "â–___|\\_________â–Œ", "â–____|\\________â–Œ", "â–_____|\\_______â–Œ", "â–______|\\______â–Œ", "â–_______|\\_____â–Œ", "â–________|\\____â–Œ", "â–_________|\\___â–Œ", "â–__________|\\__â–Œ", "â–___________|\\_â–Œ", "â–____________|\\â–Œ", "â–____________/|â–Œ", "â–___________/|_â–Œ", "â–__________/|__â–Œ", "â–_________/|___â–Œ", "â–________/|____â–Œ", "â–_______/|_____â–Œ", "â–______/|______â–Œ", "â–_____/|_______â–Œ", "â–____/|________â–Œ", "â–___/|_________â–Œ", "â–__/|__________â–Œ", "â–_/|___________â–Œ", "â–/|____________â–Œ"},
	55: {"â–â ‚       â–Œ", "â–â ˆ       â–Œ", "â– â ‚      â–Œ", "â– â        â–Œ", "â–  â¡€     â–Œ", "â–  â       â–Œ", "â–   â ‚    â–Œ", "â–   â ˆ    â–Œ", "â–    â ‚   â–Œ", "â–    â     â–Œ", "â–     â¡€  â–Œ", "â–     â    â–Œ", "â–      â ‚ â–Œ", "â–      â ˆ â–Œ", "â–       â ‚â–Œ", "â–       â  â–Œ", "â–       â¡€â–Œ", "â–      â   â–Œ", "â–      â ‚ â–Œ", "â–     â ˆ  â–Œ", "â–     â ‚  â–Œ", "â–    â     â–Œ", "â–    â¡€   â–Œ", "â–   â      â–Œ", "â–   â ‚    â–Œ", "â–  â ˆ     â–Œ", "â–  â ‚     â–Œ", "â– â        â–Œ", "â– â¡€      â–Œ", "â–â         â–Œ"},
	56: {"Â¿", "?"},
	57: {"â¢¹", "â¢º", "â¢¼", "â£¸", "â£‡", "â¡§", "â¡—", "â¡"},
	58: {"â¢„", "â¢‚", "â¢", "â¡", "â¡ˆ", "â¡", "â¡ "},
	59: {".  ", ".. ", "...", " ..", "  .", "   "},
	60: {".", "o", "O", "Â°", "O", "o", "."},
	61: {"â–“", "â–’", "â–‘"},
	62: {"â–Œ", "â–€", "â–", "â–„"},
	63: {"âŠ¶", "âŠ·"},
	64: {"â–ª", "â–«"},
	65: {"â–¡", "â– "},
	66: {"â–®", "â–¯"},
	67: {"-", "=", "â‰¡"},
	68: {"d", "q", "p", "b"},
	69: {"âˆ™âˆ™âˆ™", "â—âˆ™âˆ™", "âˆ™â—âˆ™", "âˆ™âˆ™â—", "âˆ™âˆ™âˆ™"},
	70: {"ðŸŒ‘ ", "ðŸŒ’ ", "ðŸŒ“ ", "ðŸŒ” ", "ðŸŒ• ", "ðŸŒ– ", "ðŸŒ— ", "ðŸŒ˜ "},
	71: {"â˜—", "â˜–"},
	72: {"â§‡", "â§†"},
	73: {"â—‰", "â—Ž"},
	74: {"ãŠ‚", "ãŠ€", "ãŠ"},
	75: {"â¦¾", "â¦¿"},
	76: {"á€", "á€"},
	77: {"â–Œ", "â–€", "â–â–„"},
	78: {"â ˆâ ", "â ˆâ ‘", "â ˆâ ±", "â ˆâ¡±", "â¢€â¡±", "â¢„â¡±", "â¢„â¡±", "â¢†â¡±", "â¢Žâ¡±", "â¢Žâ¡°", "â¢Žâ¡ ", "â¢Žâ¡€", "â¢Žâ ", "â Žâ ", "â Šâ "},
	79: {"________", "-_______", "_-______", "__-_____", "___-____", "____-___", "_____-__", "______-_", "_______-", "________", "_______-", "______-_", "_____-__", "____-___", "___-____", "__-_____", "_-______", "-_______", "________"},
	80: {"|_______", "_/______", "__-_____", "___\\____", "____|___", "_____/__", "______-_", "_______\\", "_______|", "______\\_", "_____-__", "____/___", "___|____", "__\\_____", "_-______"},
	81: {"â–¡", "â—±", "â—§", "â–£", "â– "},
	82: {"â–¡", "â—±", "â–¨", "â–©", "â– "},
	83: {"â–‘", "â–’", "â–“", "â–ˆ"},
	84: {"â–‘", "â–ˆ"},
	85: {"âšª", "âš«"},
	86: {"â—¯", "â¬¤"},
	87: {"â–±", "â–°"},
	88: {"âžŠ", "âž‹", "âžŒ", "âž", "âžŽ", "âž", "âž", "âž‘", "âž’", "âž“"},
	89: {"Â½", "â…“", "â…”", "Â¼", "Â¾", "â…›", "â…œ", "â…", "â…ž"},
	90: {"â†ž", "â†Ÿ", "â† ", "â†¡"},
}

// Default set
var Default = Set{Delay: 50 * time.Millisecond, Chars: CharSets[0]}

func SpinSet(set int, colors ...consoleColor) Set {
	color := 0
	if len(colors) > 0 {
		color = colors[0]
	}
	return Set{Delay: 100 * time.Millisecond, Chars: CharSets[set], Color: color}
}

// Chin is the spinner struct
type Chin struct {
	stch chan bool
	stop bool
	set  Set
	wg   *sync.WaitGroup
}

// Set defines animation chars and delay
type Set struct {
	Delay time.Duration
	Chars []string
	Color consoleColor
}

// NewChin gets a new spinner
func NewChin(sets ...Set) *Chin {
	sets = append(sets, Default)
	return &Chin{stch: make(chan bool), set: sets[0]}
}

// WithWait attaches a wait group
func (s *Chin) WithWait(wg *sync.WaitGroup) *Chin {
	wg.Add(1)
	s.wg = wg
	return s
}

// Start starts the spinner
func (s *Chin) Start() {
	hideCursor(os.Stdout)
	s.doSpin()
}

// Stop stops the spinner
func (s *Chin) Stop() {
	if s.wg != nil {
		defer s.wg.Done()
	}
	s.stop = true
	erase(os.Stdout)
	unhideCursor(os.Stdout)
}

func (s *Chin) doSpin() {
	for {
	outer:
		select {
		case _, ok := <-s.stch:
			if ok {
				//fmt.Print("\010")
				erase(os.Stdout)
				break outer
			}
		default:
			for _, c := range s.set.Chars {
				if s.stop {
					s.stch <- true
				} else if len(c) > 0 {
					erase(os.Stdout)
					//fmt.Print(c, "\010")
					output := c
					if s.set.Color > 0 {
						output = colorize(output, s.set.Color)
					}
					fmt.Print(output)
					time.Sleep(s.set.Delay)
				}
			}
		}
	}
}

// erase clears the line
func erase(w io.Writer) {
	_, _ = fmt.Fprint(w, "\r\033[K\r")
}

func hideCursor(_ io.Writer) {
	// Please note, the program crashes or is
	// killed, you may need to reset your terminal for the cursor to appear
	// again. So we turn off the feature.
	//_, err := fmt.Fprint(w, "\r\033[?25l\r")
	//return err
}

func unhideCursor(_ io.Writer) {
	return
	//_, err := fmt.Fprint(w, "\r\033[?25h\r")
	//return err
}
